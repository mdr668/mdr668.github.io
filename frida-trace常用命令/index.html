<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Frida-trace常用命令 - mdr's Blog</title><meta name=author content="mdr"><meta name=author-link content="https://github.com/mdr668"><meta name=description content="1、spawn - 冷启动 $ frida-trace -U -f com.apple.ExampleCode -m &#34;+[NSURL URLWithString:]&#34; 2、attach - 热启动 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 3、Hook类方法 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 4、Hook实例方法 $ frida-trace -UF -m &#34;-[NSURL host]&#34; 5、"><meta name=keywords content="Hugo,FixIt"><meta itemprop=name content="Frida-trace常用命令"><meta itemprop=description content="1、spawn - 冷启动 $ frida-trace -U -f com.apple.ExampleCode -m &#34;+[NSURL URLWithString:]&#34; 2、attach - 热启动 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 3、Hook类方法 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 4、Hook实例方法 $ frida-trace -UF -m &#34;-[NSURL host]&#34; 5、"><meta itemprop=datePublished content="2023-04-26T00:00:00+00:00"><meta itemprop=dateModified content="2023-04-26T00:00:00+00:00"><meta itemprop=wordCount content="2790"><meta itemprop=keywords content><meta property="og:title" content="Frida-trace常用命令"><meta property="og:description" content="1、spawn - 冷启动 $ frida-trace -U -f com.apple.ExampleCode -m &#34;+[NSURL URLWithString:]&#34; 2、attach - 热启动 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 3、Hook类方法 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 4、Hook实例方法 $ frida-trace -UF -m &#34;-[NSURL host]&#34; 5、"><meta property="og:type" content="article"><meta property="og:url" content="/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-26T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Frida-trace常用命令"><meta name=twitter:description content="1、spawn - 冷启动 $ frida-trace -U -f com.apple.ExampleCode -m &#34;+[NSURL URLWithString:]&#34; 2、attach - 热启动 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 3、Hook类方法 $ frida-trace -UF -m &#34;+[NSURL URLWithString:]&#34; 4、Hook实例方法 $ frida-trace -UF -m &#34;-[NSURL host]&#34; 5、"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/><link rel=prev href=/mweb%E4%B8%8A%E9%9D%A2%E7%9A%84hugo%E4%B8%80%E9%94%AE%E5%8F%91%E5%B8%83%E8%84%9A%E6%9C%AC/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Frida-trace常用命令","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"\/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4\/"},"genre":"posts","wordcount":2790,"url":"\/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4\/","datePublished":"2023-04-26T00:00:00+00:00","dateModified":"2023-04-26T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"猫大人"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="mdr's Blog"><img loading=lazy src=NFT-013063-a2fc488f-00054799.webp srcset="/NFT-013063-a2fc488f-00054799.webp, NFT-013063-a2fc488f-00054799.webp 1.5x, /NFT-013063-a2fc488f-00054799.webp 2x" sizes=auto data-title="mdr's Blog" data-alt="mdr's Blog" width=240 height=240 class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>猫大人的自留地</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="mdr's Blog"><img loading=lazy src=NFT-013063-a2fc488f-00054799.webp srcset="/NFT-013063-a2fc488f-00054799.webp, NFT-013063-a2fc488f-00054799.webp 1.5x, /NFT-013063-a2fc488f-00054799.webp 2x" sizes=auto data-title=/NFT-013063-a2fc488f-00054799.webp data-alt=/NFT-013063-a2fc488f-00054799.webp width=240 height=240 class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>猫大人的自留地</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Frida-trace常用命令</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
猫大人</span></span></div><div class=post-meta-line><span title="发布于 2023-04-26 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-04-26>2023-04-26</time></span>&nbsp;<span title="更新于 2023-04-26 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-04-26>2023-04-26</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2790 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 6 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1spawn-冷启动>1、spawn - 冷启动</a></li><li><a href=#2attach-热启动>2、attach - 热启动</a></li><li><a href=#3hook类方法>3、Hook类方法</a></li><li><a href=#4hook实例方法>4、Hook实例方法</a></li><li><a href=#5hook类的所有方法>5、Hook类的所有方法</a></li><li><a href=#6模糊hook类的所有方法>6、模糊Hook类的所有方法</a></li><li><a href=#7模糊hook所有类的特定方法>7、模糊Hook所有类的特定方法</a></li><li><a href=#8模糊hook所有类的特定方法并忽略大小写>8、模糊Hook所有类的特定方法并忽略大小写</a></li><li><a href=#9模糊hook所有类的特定方法并排除viewdidload方法>9、模糊Hook所有类的特定方法并排除viewDidLoad方法</a></li><li><a href=#10hook某个动态库>10、Hook某个动态库</a></li><li><a href=#11hookget或post的接口地址>11、Hook get或post的接口地址</a></li><li><a href=#12hookpost的body>12、Hook post的body</a></li><li><a href=#13hook即将显示页面>13、Hook即将显示页面</a></li><li><a href=#14hookmd5函数>14、Hook MD5函数</a></li><li><a href=#15hookbase64编码方法>15、Hook Base64编码方法</a></li><li><a href=#16hookbase64解码方法>16、Hook Base64解码方法</a></li><li><a href=#17hook加密函数aesdes3des>17、Hook加密函数AES、DES、3DES</a></li><li><a href=#18hook加密函数rsa>18、Hook加密函数RSA</a></li><li><a href=#19修改方法的入参>19、修改方法的入参</a></li><li><a href=#20修改方法的返回值>20、修改方法的返回值</a></li><li><a href=#21打印字符串数组字典>21、打印字符串、数组、字典</a></li><li><a href=#22打印nsdata>22、打印NSData</a></li><li><a href=#23打印对象的所有属性和方法>23、打印对象的所有属性和方法</a></li><li><a href=#24打印调用栈>24、打印调用栈</a></li><li><a href=#25日志输出到文件>25、日志输出到文件</a></li><li><a href=#26更多数据类型>26、更多数据类型</a></li></ul></nav></div></div><div class=content id=content><h2 id=1spawn-冷启动>1、spawn - 冷启动</h2><pre><code>$ frida-trace -U -f com.apple.ExampleCode -m &quot;+[NSURL URLWithString:]&quot;
</code></pre><h2 id=2attach-热启动>2、attach - 热启动</h2><pre><code>$ frida-trace -UF -m &quot;+[NSURL URLWithString:]&quot;
</code></pre><h2 id=3hook类方法>3、Hook类方法</h2><pre><code>$ frida-trace -UF -m &quot;+[NSURL URLWithString:]&quot;
</code></pre><h2 id=4hook实例方法>4、Hook实例方法</h2><pre><code>$ frida-trace -UF -m &quot;-[NSURL host]&quot;
</code></pre><h2 id=5hook类的所有方法>5、Hook类的所有方法</h2><pre><code>$ frida-trace -UF -m &quot;*[NSURL *]&quot;
</code></pre><h2 id=6模糊hook类的所有方法>6、模糊Hook类的所有方法</h2><pre><code>$ frida-trace -UF -m &quot;*[*service* *]&quot;
</code></pre><h2 id=7模糊hook所有类的特定方法>7、模糊Hook所有类的特定方法</h2><pre><code>$ frida-trace -UF -m &quot;*[* *sign*]&quot;
</code></pre><h2 id=8模糊hook所有类的特定方法并忽略大小写>8、模糊Hook所有类的特定方法并忽略大小写</h2><p>假设我们要hook所有类中包含getSign或getsign关键词的方法</p><pre><code>$ frida-trace -UF -m &quot;*[* get?ign]&quot;
</code></pre><h2 id=9模糊hook所有类的特定方法并排除viewdidload方法>9、模糊Hook所有类的特定方法并排除viewDidLoad方法</h2><pre><code>$ frida-trace -UF -m &quot;*[DetailViewController *]&quot; -M &quot;-[DetailViewController viewDidLoad]&quot;
</code></pre><h2 id=10hook某个动态库>10、Hook某个动态库</h2><pre><code>$ frida-trace -UF -I &quot;libcommonCrypto*&quot;
</code></pre><h2 id=11hookget或post的接口地址>11、Hook get或post的接口地址</h2><pre><code>$ frida-trace -UF -m &quot;+[NSURL URLWithString:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var args2 = new ObjC.Object(args[2]);
    log(`-[NSURL URLWithString:${args2}]`);
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><h2 id=12hookpost的body>12、Hook post的body</h2><pre><code>$ frida-trace -UF -m &quot;-[NSMutableURLRequest setHTTPBody:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var args2 = new ObjC.Object(args[2]);
    log(`-[NSMutableURLRequest setHTTPBody:${args2.bytes().readUtf8String(args2.length())}]`);
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><h2 id=13hook即将显示页面>13、Hook即将显示页面</h2><pre><code>$ frida-trace -UF -m &quot;-[UINavigationController pushViewController:animated:]&quot; -m &quot;-[UIViewController presentViewController:animated:completion:]&quot;
</code></pre><p><code>pushViewController:animated:</code>方法的js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var args2 = new ObjC.Object(args[2]);
    log(`-[UINavigationController pushViewController:${args2.$className} animated:${args[3]}]`);
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><p><code>presentViewController:animated:completion:</code>方法对应的js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var args2 = new ObjC.Object(args[2]);
    log(`-[UIViewController presentViewController:${args2.$className} animated:${args[3]} completion:${args[4]}]`);
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><h2 id=14hookmd5函数>14、Hook MD5函数</h2><pre><code>$ frida-trace -UF -i &quot;CC_MD5&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    this.args0 = args[0];	// 入参
    this.args2 = args[2];	// 返回值指针
  },
  onLeave(log, retval, state) {
    var ByteArray = Memory.readByteArray(this.args2, 16);
    var uint8Array = new Uint8Array(ByteArray);

    var str = &quot;&quot;;
    for(var i = 0; i &lt; uint8Array.length; i++) {
        var hextemp = (uint8Array[i].toString(16))
        if(hextemp.length == 1){
            hextemp = &quot;0&quot; + hextemp
        }
        str += hextemp;
    }
    log(`CC_MD5(${this.args0.readUtf8String()})`);   	// 入参
    log(`CC_MD5()=${str}=`);													// 返回值
  }
}
</code></pre><h2 id=15hookbase64编码方法>15、Hook Base64编码方法</h2><pre><code>$ frida-trace -UF -m &quot;-[NSData base64EncodedStringWithOptions:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    this.self = args[0];
  },
  onLeave(log, retval, state) {
    var before = ObjC.classes.NSString.alloc().initWithData_encoding_(this.self, 4);
    var after = new ObjC.Object(retval);
    log(`-[NSData base64EncodedStringWithOptions:]before=${before}=`);
    log(`-[NSData base64EncodedStringWithOptions:]after=${after}=`);
  }
}
</code></pre><h2 id=16hookbase64解码方法>16、Hook Base64解码方法</h2><pre><code>$ frida-trace -UF -m &quot;-[NSData initWithBase64EncodedData:options:]&quot; -m &quot;-[NSData initWithBase64EncodedString:options:]&quot;
</code></pre><p><code>initWithBase64EncodedData:options:</code>方法对应的js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    this.arg2 = args[2];
  },
  onLeave(log, retval, state) {
    var before = ObjC.classes.NSString.alloc().initWithData_encoding_(this.arg2, 4);
    var after = ObjC.classes.NSString.alloc().initWithData_encoding_(retval, 4);
    log(`-[NSData initWithBase64EncodedData:]before=${before}=`);
    log(`-[NSData initWithBase64EncodedData:]after=${after}=`);
  }
}
</code></pre><p><code>initWithBase64EncodedString:options:</code>方法对应的js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    this.arg2 = args[2];
  },
  onLeave(log, retval, state) {
    var before = new ObjC.Object(this.arg2);
    var after = ObjC.classes.NSString.alloc().initWithData_encoding_(retval, 4);
    log(`-[NSData initWithBase64EncodedString:]before=${before}=`);
    log(`-[NSData initWithBase64EncodedString:]after=${after}=`);
  }
}
</code></pre><h2 id=17hook加密函数aesdes3des>17、Hook加密函数AES、DES、3DES</h2><pre><code>frida-trace -UF -i CCCrypt
</code></pre><p>js代码如下：</p><pre><code>{
	onEnter: function(log, args, state) {
		this.op = args[0]
		this.alg = args[1]
		this.options = args[2]
		this.key = args[3]
		this.keyLength = args[4]
		this.iv = args[5]
		this.dataIn = args[6]
		this.dataInLength = args[7]
		this.dataOut = args[8]
		this.dataOutAvailable = args[9]
		this.dataOutMoved = args[10]

		log('CCCrypt(' +
			'op: ' + this.op + '[0:加密,1:解密]' + ', ' +
			'alg: ' + this.alg + '[0:AES128,1:DES,2:3DES]' + ', ' +
			'options: ' + this.options + '[1:ECB,2:CBC,3:CFB]' + ', ' +
			'key: ' + this.key + ', ' +
			'keyLength: ' + this.keyLength + ', ' +
			'iv: ' + this.iv + ', ' +
			'dataIn: ' + this.dataIn + ', ' +
			'inLength: ' + this.inLength + ', ' +
			'dataOut: ' + this.dataOut + ', ' +
			'dataOutAvailable: ' + this.dataOutAvailable + ', ' +
			'dataOutMoved: ' + this.dataOutMoved + ')')

		if (this.op == 0) {
			log(&quot;dataIn:&quot;)
			log(hexdump(ptr(this.dataIn), {
				length: this.dataInLength.toInt32(),
				header: true,
				ansi: true
			}))
			log(&quot;key: &quot;)
			log(hexdump(ptr(this.key), {
				length: this.keyLength.toInt32(),
				header: true,
				ansi: true
			}))
			log(&quot;iv: &quot;)
			log(hexdump(ptr(this.iv), {
				length: this.keyLength.toInt32(),
				header: true,
				ansi: true
			}))
		}
	},
	onLeave: function(log, retval, state) {
		if (this.op == 1) {
			log(&quot;dataOut:&quot;)
			log(hexdump(ptr(this.dataOut), {
				length: Memory.readUInt(this.dataOutMoved),
				header: true,
				ansi: true
			}))
			log(&quot;key: &quot;)
			log(hexdump(ptr(this.key), {
				length: this.keyLength.toInt32(),
				header: true,
				ansi: true
			}))
			log(&quot;iv: &quot;)
			log(hexdump(ptr(this.iv), {
				length: this.keyLength.toInt32(),
				header: true,
				ansi: true
			}))
		} else {
			log(&quot;dataOut:&quot;)
			log(hexdump(ptr(this.dataOut), {
				length: Memory.readUInt(this.dataOutMoved),
				header: true,
				ansi: true
			}))
		}
		log(&quot;CCCrypt did finish&quot;)
	}
}
</code></pre><h2 id=18hook加密函数rsa>18、Hook加密函数RSA</h2><p>rsa加密有公钥加密和私钥加密两种方式</p><pre><code>$ frida-trace -UF -i &quot;SecKeyEncrypt&quot; -i &quot;SecKeyRawSign&quot;
</code></pre><p><code>SecKeyEncrypt</code>公钥加密函数对应的js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    // 由于同一条加密信息可能会多次调用该函数，故在这输出该函数的调用栈。可根据栈信息去分析上层函数
    log(`SecKeyEncrypt()=${args[2].readCString()}=`);
    log('SecKeyEncrypt called from:\n' +
        Thread.backtrace(this.context, Backtracer.ACCURATE)
        .map(DebugSymbol.fromAddress).join('\n') + '\n');
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><p><code>SecKeyRawSign</code>私钥加密函数对应的js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    log(`SecKeyRawSign()=${args[2].readCString()}=`);
    log('SecKeyRawSign called from:\n' +
        Thread.backtrace(this.context, Backtracer.ACCURATE)
        .map(DebugSymbol.fromAddress).join('\n') + '\n');
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><h2 id=19修改方法的入参>19、修改方法的入参</h2><pre><code>$ frida-trace -UF -m &quot;-[DetailViewController setObj:]&quot;
</code></pre><p>js代码如下：</p><pre><code>/*
 * Auto-generated by Frida. Please modify to match the signature of -[DetailViewController setObj:].
 * This stub is currently auto-generated from manpages when available.
 *
 * For full API reference, see: https://frida.re/docs/javascript-api/
 */

{
  /**
   * Called synchronously when about to call -[DetailViewController setObj:].
   *
   * @this {object} - Object allowing you to store state for use in onLeave.
   * @param {function} log - Call this function with a string to be presented to the user.
   * @param {array} args - Function arguments represented as an array of NativePointer objects.
   * For example use args[0].readUtf8String() if the first argument is a pointer to a C string encoded as UTF-8.
   * It is also possible to modify arguments by assigning a NativePointer object to an element of this array.
   * @param {object} state - Object allowing you to keep state across function calls.
   * Only one JavaScript function will execute at a time, so do not worry about race-conditions.
   * However, do not use this to store function arguments across onEnter/onLeave, but instead
   * use &quot;this&quot; which is an object for keeping state local to an invocation.
   */
  onEnter(log, args, state) {
    var self = new ObjC.Object(args[0]);  // 当前对象
    var method = args[1].readUtf8String();  // 当前方法名
    log(`[${self.$className} ${method}]`);

    // 字符串
    // var str = ObjC.classes.NSString.stringWithString_(&quot;hi wit!&quot;)  // 对应的oc语法：NSString *str = [NSString stringWithString:@&quot;hi with!&quot;];
    // args[2] = str  // 修改入参为字符串

    // 数组
    // var array = ObjC.classes.NSMutableArray.array();  // 对应的oc语法：NSMutableArray array = [NSMutablearray array];
    // array.addObject_(&quot;item1&quot;);  // 对应的oc语法：[array addObject:@&quot;item1&quot;];
    // array.addObject_(&quot;item2&quot;);  // 对应的oc语法：[array addObject:@&quot;item2&quot;];
    // args[2] = array; // 修改入参为数组

    // 字典
    // var dictionary = ObjC.classes.NSMutableDictionary.dictionary(); // 对应的oc语法:NSMutableDictionary *dictionary = [NSMutableDictionary dictionary];
    // dictionary.setObject_forKey_(&quot;value1&quot;, &quot;key1&quot;); // 对应的oc语法：[dictionary setObject:@&quot;value1&quot; forKey:@&quot;key1&quot;]
    // dictionary.setObject_forKey_(&quot;value2&quot;, &quot;key2&quot;); // 对应的oc语法：[dictionary setObject:@&quot;value2&quot; forKey:@&quot;key2&quot;]
    // args[2] = dictionary; // 修改入参为字典

    // 字节
    var data = ObjC.classes.NSMutableData.data(); // 对应的oc语法：NSMutableData *data = [NSMutableData data];
    var str = ObjC.classes.NSString.stringWithString_(&quot;hi wit!&quot;)  // 获取一个字符串。 对应的oc语法：NSString *str = [NSString stringWithString:@&quot;hi with!&quot;];
    var subData = str.dataUsingEncoding_(4);  // 将str转换为data,编码为utf-8。对应的oc语法：NSData *subData = [str dataUsingEncoding:NSUTF8StringEncoding];
    data.appendData_(subData);  // 将subData添加到data。对应的oc语法：[data appendData:subData];
    args[2] = data; // 修改入参字段

    // 更多数据类型：https://developer.apple.com/documentation/foundation
  },

  onLeave(log, retval, state) {

  }
}
</code></pre><h2 id=20修改方法的返回值>20、修改方法的返回值</h2><pre><code>$ frida-trace -UF -m &quot;-[DetailViewController Obj]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {

  },
  onLeave(log, retval, state) {
    // 字符串
    var str = ObjC.classes.NSString.stringWithString_(&quot;hi wit!&quot;)  // 对应的oc语法：NSString *str = [NSString stringWithString:@&quot;hi with!&quot;];
    retval.replace(str)  // 修改返回值
    var after = new ObjC.Object(retval); // 打印出来是个指针时，请用该方式转换后再打印
    log(`before:=${retval}=`);
    log(`after:=${after}=`);
  }
}
</code></pre><h2 id=21打印字符串数组字典>21、打印字符串、数组、字典</h2><pre><code>$ frida-trace -UF -m &quot;-[DetailViewController setObj:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var self = new ObjC.Object(args[0]);  // 当前对象
    var method = args[1].readUtf8String();  // 当前方法名
    log(`[${self.$className} ${method}]`);

    var before = args[2];
    // 注意，日志输出请直接使用log函数。不要使用console.log()
    var after = new ObjC.Object(args[2]); // 打印出来是个指针时，请用该方式转换后再打印
    log(`before:=${before}=`);
    log(`after:=${after}=`);
  },
  onLeave(log, retval, state) {

  }
}
</code></pre><h2 id=22打印nsdata>22、打印NSData</h2><pre><code>$ frida-trace -UF -m &quot;-[DetailViewController setObj:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var self = new ObjC.Object(args[0]);  // 当前对象
    var method = args[1].readUtf8String();  // 当前方法名
    log(`[${self.$className} ${method}]`);

    var before = args[2];

    // 注意，日志输出请直接使用log函数。不要使用console.log()
   
    var after = new ObjC.Object(args[2]); // 打印NSData
    var outValue = after.bytes().readUtf8String(after.length()) // 将data转换为string
    log(`before:=${before}=`);
    log(`after:=${outValue}=`);
  },
  onLeave(log, retval, state) {

  }
}
</code></pre><h2 id=23打印对象的所有属性和方法>23、打印对象的所有属性和方法</h2><pre><code>$ frida-trace -UF -m &quot;-[DetailViewController setObj:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var self = new ObjC.Object(args[0]);  // 当前对象
    var method = args[1].readUtf8String();  // 当前方法名
    log(`[${self.$className} ${method}]`);

    var customObj = new ObjC.Object(args[2]); // 自定义对象
    // 打印该对象所有属性
    var ivarList = customObj.$ivars;
    for (key in ivarList) {
       log(`key${key}=${ivarList[key]}=`);
    }

    // 打印该对象所有方法
    var methodList = customObj.$methods;
    for (var i=0; i&lt;methodList.length; i++) {
       log(`method=${methodList[i]}=`);
    }
  },
  onLeave(log, retval, state) {

  }
}
</code></pre><h2 id=24打印调用栈>24、打印调用栈</h2><pre><code>$ frida-trace -UF -m &quot;+[NSURL URLWithString:]&quot;
</code></pre><p>js代码如下：</p><pre><code>{
  onEnter(log, args, state) {
    var url = new ObjC.Object(args[2]);
    log(`+[NSURL URLWithString:${url}]`);
    log('NSURL URLWithString: called from:\n' +
        Thread.backtrace(this.context, Backtracer.ACCURATE)
        .map(DebugSymbol.fromAddress).join('\n') + '\n');
  },
  onLeave(log, retval, state) {
  }
}
</code></pre><h2 id=25日志输出到文件>25、日志输出到文件</h2><pre><code>$ frida-trace -UF -m &quot;+[NSURL URLWithString:]&quot; -o run.log
</code></pre><h2 id=26更多数据类型>26、更多数据类型</h2><pre><code>/**
 * Converts to a signed 32-bit integer.
 */
  toInt32(): number;

  /**
  * Converts to an unsigned 32-bit integer.
  */
  toUInt32(): number;

  /**
  * Converts to a “0x”-prefixed hexadecimal string, unless a `radix`
  * is specified.
  */
  toString(radix?: number): string;

  /**
  * Converts to a JSON-serializable value. Same as `toString()`.
  */
  toJSON(): string;

  /**
  * Returns a string containing a `Memory#scan()`-compatible match pattern for this pointer’s raw value.
  */
  toMatchPattern(): string;

  readPointer(): NativePointer;
  readS8(): number;
  readU8(): number;
  readS16(): number;
  readU16(): number;
  readS32(): number;
  readU32(): number;
  readS64(): Int64;
  readU64(): UInt64;
  readShort(): number;
  readUShort(): number;
  readInt(): number;
  readUInt(): number;
  readLong(): number | Int64;
  readULong(): number | UInt64;
  readFloat(): number;
  readDouble(): number;
  readByteArray(length: number): ArrayBuffer | null;
  readCString(size?: number): string | null;
  readUtf8String(size?: number): string | null;
  readUtf16String(length?: number): string | null;
</code></pre><p>以上就是关于frida-trace在iOS端的常用命令，希望能帮助到大家。同时也建议大家阅读官方文档：<a href=https://frida.re/docs/frida-trace/ target=_blank rel="external nofollow noopener noreferrer">https://frida.re/docs/frida-trace/</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2023-04-26 00:00:00">更新于 2023-04-26&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ data-title=Frida-trace常用命令><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=/frida-trace%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ data-title=Frida-trace常用命令><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/mweb%E4%B8%8A%E9%9D%A2%E7%9A%84hugo%E4%B8%80%E9%94%AE%E5%8F%91%E5%B8%83%E8%84%9A%E6%9C%AC/ class=post-nav-item rel=prev title=MWeb上面的hugo一键发布脚本><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>MWeb上面的hugo一键发布脚本</a></div></div><div id=comments><div id=commento class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://commento.io/ rel="external nofollow noopener noreferrer">Commento</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">已经持续输出</span><span class="run-times ms-1">网站运行中……</span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/katex/katex.min.css><script src=https://cdn.commento.io/js/commento.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!0,expired:!1},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},siteTime:"2022-12-18T16:15:22+08:00"}</script><script src=/js/theme.min.js defer></script></body></html>